- name: deploy checkmk local check
  hosts: all
  become: yes
  become_user: root
  become_method: sudo

  vars:
    local_check_src: "900_security_watch"
    local_check_dest: "/usr/lib/check_mk_agent/local/900_security_watch"
    state_dir: "/var/lib/check_mk_agent/security_watch"

  tasks:
    - name: ensure checkmk local dir exists
      ansible.builtin.file:
        path: "/usr/lib/check_mk_agent/local"
        state: directory
        owner: root
        group: root
        mode: "0755"

    - name: ensure state dir exists
      ansible.builtin.file:
        path: "{{ state_dir }}"
        state: directory
        owner: root
        group: root
        mode: "0750"

    - name: deploy local check script
      ansible.builtin.copy:
        src: "{{ local_check_src }}"
        dest: "{{ local_check_dest }}"
        owner: root
        group: root
        mode: "0755"
